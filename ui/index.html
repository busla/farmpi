<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="weather-icons/css/weather-icons.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>
  <body>
    

<div class="jumbotron">
  <div class="container">
    <h1 class="text-center">Reykjalundur Squash Sensors</h1>    
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-6">
      <div class="row">
        <div class="col-xs-12">
          <div class="thumbnail text-center">
            <i class="wi wi-thermometer-internal"></i>
            <div class="caption">
              <h3>Soil temperature</h3>
              <span id="soil" class="temperature"></span><span class="scale">&deg;C</span>
              <p class="time"></p>
            </div>
          </div>
        </div>
      </div>
    </div>  
    <div class="col-xs-12 col-sm-6">
      <div class="row">
        <div class="col-xs-12">
          <div class="thumbnail text-center">
            <i class="wi wi-thermometer-exterior"></i>
            <div class="caption">
              <h3>Air temperature</h3>
              <span id="air" class="temperature"></span><span class="scale">&deg;C</span>
              <p class="time"></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <canvas id="tempChart"></canvas>
    </div>
  </div>
</div>
  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>   
  <script src="Chart.js/Chart.min.js"></script>   


  <script>


    var data = {
        labels: [],
        datasets: [
            {
                label: "Air temperature",
                fillColor: "rgba(220,220,220,0.2)",
                strokeColor: "rgba(220,220,220,1)",
                pointColor: "rgba(220,220,220,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(220,220,220,1)",
                data: [],
            },
            {
                label: "Soil temperature",
                fillColor: "rgba(151,187,205,0.2)",
                strokeColor: "rgba(151,187,205,1)",
                pointColor: "rgba(151,187,205,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(151,187,205,1)",
                data: [],
            }
        ]
    };    

    
    Chart.defaults.global.responsive = true;
    var ctx = $("#tempChart").get(0).getContext("2d");
    // This will get the first returned node in the jQuery collection.
    var myLineChart = new Chart(ctx).Line(data);
    

    var airData = [];
    var soilData = [];
    var tempDate = [];

    $.getJSON( "data/charts.json", function( jsonFile ) {
      
      $.each( jsonFile, function(i, value) {
        if (value.type == 'soil')Â {
          soilData.push(value.temperature);          
        }

        else {
          airData.push(value.temperature);
        }

        tempDate.push(value.date)        
        
        console.log(value.date);  
      });
      for (var i = 0; i < (soilData.length - 10); i++) {
          myLineChart.addData([soilData[i], airData[i]], tempDate[i]);
          //Do something
      }      
      
    });
   
    
  </script>


  <script>
    var socket = io();
    socket.on('temperature', function(data){
      console.log(data);
      var now = new Date();
      $('#'+data.type).text(data.temperature);
      $('.time').text(now);      
    });
  </script>

  </body>
</html>

